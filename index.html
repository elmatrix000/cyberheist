<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CYBERHEIST</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>

<style>
html,body{
  margin:0;
  padding:0;
  background:#000;
  overflow:hidden;
  touch-action:none;
}
#overlay{
  position:fixed;
  inset:0;
  background:radial-gradient(circle,#0a0a0a,#000);
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  color:#0ff;
  font-family:monospace;
  z-index:10;
  pointer-events:auto;
}
#overlay h1{
  font-size:28px;
  margin-bottom:10px;
}
#overlay p{
  opacity:.7;
}
</style>
</head>

<body>

<div id="overlay">
  <h1>⚡ CYBERHEIST ⚡</h1>
  <p>TOUCH TO JACK IN</p>
</div>

<script>
/* ---------- SAFARI SAFE OVERLAY ---------- */
const overlay = document.getElementById("overlay");
function startGame(){
  overlay.style.display="none";
}
overlay.addEventListener("pointerdown", startGame, {once:true});
overlay.addEventListener("touchstart", startGame, {once:true});
overlay.addEventListener("click", startGame, {once:true});

/* ---------- GAME CONFIG ---------- */
const GAME_W = 360;
const GAME_H = 640;

const config = {
  type: Phaser.AUTO,
  width: GAME_W,
  height: GAME_H,
  backgroundColor: "#050505",
  physics: {
    default: "arcade",
    arcade: { debug:false }
  },
  scale:{
    mode: Phaser.Scale.FIT,
    autoCenter: Phaser.Scale.CENTER_BOTH
  },
  scene:{ preload, create, update }
};

new Phaser.Game(config);

let player, bullets, enemies, boss;
let score = 0;
let scoreText;
let fireCooldown = 0;
let bossSpawned = false;

/* ---------- PRELOAD ---------- */
function preload(){
  this.load.image("player","player.PNG");
  this.load.image("enemy","enemy.PNG");
  this.load.image("drone","drone.PNG");
  this.load.image("boss","boss.PNG");
  this.load.image("bullet","bullet.PNG");
  this.load.image("data","data.PNG");
}

/* ---------- CREATE ---------- */
function create(){
  score = 0;
  bossSpawned = false;

  player = this.physics.add.sprite(GAME_W/2, GAME_H-80, "player")
    .setScale(0.6)
    .setCollideWorldBounds(true);

  bullets = this.physics.add.group();
  enemies = this.physics.add.group();

  scoreText = this.add.text(10,10,"SCORE: 0",{font:"14px monospace",fill:"#0ff"});

  /* TOUCH MOVE */
  this.input.on("pointermove", p=>{
    player.x = Phaser.Math.Clamp(p.x, 20, GAME_W-20);
  });

  /* TOUCH SHOOT */
  this.input.on("pointerdown", ()=>{
    if(fireCooldown<=0) shoot(this);
  });

  /* SPAWN ENEMIES */
  this.time.addEvent({
    delay:800,
    loop:true,
    callback:()=>spawnEnemy(this)
  });

  /* COLLISIONS */
  this.physics.add.overlap(bullets,enemies,hitEnemy,null,this);
  this.physics.add.overlap(bullets,()=>boss,hitBoss,null,this);
  this.physics.add.overlap(player,enemies,gameOver,null,this);
}

/* ---------- UPDATE ---------- */
function update(time,delta){
  fireCooldown -= delta;

  bullets.children.each(b=>{
    if(b && b.y<-20) b.destroy();
  });

  enemies.children.each(e=>{
    if(e && e.y>GAME_H+40) e.destroy();
  });

  if(score>=500 && !bossSpawned){
    spawnBoss(this);
  }

  if(boss){
    boss.x += Math.sin(time*0.002)*1.5;
  }
}

/* ---------- SHOOT ---------- */
function shoot(scene){
  fireCooldown = 250;
  const b = bullets.create(player.x,player.y-20,"bullet")
    .setScale(0.8);
  b.body.setVelocityY(-500);
}

/* ---------- ENEMY ---------- */
function spawnEnemy(scene){
  if(bossSpawned) return;
  const x = Phaser.Math.Between(30,GAME_W-30);
  const e = enemies.create(x,-40,Math.random()<0.5?"enemy":"drone")
    .setScale(0.5);
  e.body.setVelocityY(Phaser.Math.Between(120,200));
}

/* ---------- HIT ENEMY ---------- */
function hitEnemy(b,e){
  b.destroy();
  e.destroy();
  score += 10;
  scoreText.setText("SCORE: "+score);
}

/* ---------- BOSS ---------- */
function spawnBoss(scene){
  bossSpawned = true;
  boss = scene.physics.add.sprite(GAME_W/2,120,"boss")
    .setScale(0.6);
  boss.hp = 50;
}

function hitBoss(b){
  if(!boss) return;
  b.destroy();
  boss.hp--;
  boss.setTintFill(0xff0000);
  setTimeout(()=>boss.clearTint(),50);

  if(boss.hp<=0){
    boss.destroy();
    boss = null;
    score += 200;
    scoreText.setText("SCORE: "+score);
  }
}

/* ---------- GAME OVER ---------- */
function gameOver(){
  this.scene.restart();
}
</script>
</body>
</html>
