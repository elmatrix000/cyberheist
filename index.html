<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CYBERHEIST</title>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

<script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>

<style>
html,body{
  margin:0;
  padding:0;
  background:#000;
  overflow:hidden;
  touch-action:none;
}
#overlay{
  position:fixed;
  inset:0;
  background:#000;
  color:#0ff;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  font-family:monospace;
  z-index:10;
}
canvas{
  display:block;
  margin:auto;
}
</style>
</head>

<body>

<div id="overlay">
  <h2>⚡ CYBERHEIST ⚡</h2>
  <p>TOUCH TO JACK IN</p>
</div>

<script>
/* ---------------- OVERLAY FIX ---------------- */
const overlay = document.getElementById("overlay");
overlay.addEventListener("pointerdown",()=>overlay.style.display="none",{once:true});
overlay.addEventListener("touchstart",()=>overlay.style.display="none",{once:true});

/* ---------------- GAME CONSTANTS ---------------- */
const WIDTH = 360;
const HEIGHT = 640;

/* ---------------- PHASER CONFIG ---------------- */
const config = {
  type: Phaser.CANVAS,
  width: WIDTH,
  height: HEIGHT,
  backgroundColor: "#050505",
  physics:{
    default:"arcade",
    arcade:{debug:false}
  },
  scale:{
    mode: Phaser.Scale.NONE
  },
  scene:{ preload, create, update }
};

new Phaser.Game(config);

/* ---------------- GLOBALS ---------------- */
let player, bullets, enemies, boss;
let score = 0;
let scoreText;
let canShoot = true;
let bossActive = false;

/* ---------------- PRELOAD ---------------- */
function preload(){
  this.load.image("player","player.PNG");
  this.load.image("enemy","enemy.PNG");
  this.load.image("drone","drone.PNG");
  this.load.image("boss","boss.PNG");
  this.load.image("bullet","bullet.PNG");
}

/* ---------------- CREATE ---------------- */
function create(){

  /* PLAYER */
  player = this.physics.add.sprite(WIDTH/2, HEIGHT-70, "player")
    .setOrigin(0.5)
    .setScale(0.25)
    .setCollideWorldBounds(true)
    .setDepth(5);

  /* GROUPS */
  bullets = this.physics.add.group({ maxSize: 30 });
  enemies = this.physics.add.group();

  /* UI */
  score = 0;
  scoreText = this.add.text(10,10,"SCORE: 0",{
    font:"14px monospace",
    fill:"#0ff"
  }).setDepth(10);

  /* TOUCH MOVE */
  this.input.on("pointermove", p=>{
    player.x = Phaser.Math.Clamp(p.x, 20, WIDTH-20);
  });

  /* TOUCH SHOOT */
  this.input.on("pointerdown", ()=>{
    if(canShoot) fireBullet(this);
  });

  /* ENEMY SPAWN */
  this.time.addEvent({
    delay:900,
    loop:true,
    callback:()=>spawnEnemy(this)
  });

  /* COLLISIONS */
  this.physics.add.overlap(bullets,enemies,onEnemyHit,null,this);
  this.physics.add.overlap(player,enemies,onPlayerHit,null,this);
  this.physics.add.overlap(bullets,()=>boss,onBossHit,null,this);
}

/* ---------------- UPDATE ---------------- */
function update(){

  bullets.children.each(b=>{
    if(b && b.y < -20) b.destroy();
  });

  enemies.children.each(e=>{
    if(e && e.y > HEIGHT+40) e.destroy();
  });

  if(score >= 500 && !bossActive){
    spawnBoss(this);
  }

  if(boss){
    boss.x += Math.sin(this.time.now * 0.002) * 1.2;
  }
}

/* ---------------- BULLET ---------------- */
function fireBullet(scene){
  canShoot = false;

  const b = bullets.create(player.x, player.y-25, "bullet")
    .setOrigin(0.5)
    .setScale(0.4)
    .setDepth(6);

  b.body.setVelocityY(-520);

  scene.time.delayedCall(250,()=>canShoot=true);
}

/* ---------------- ENEMY ---------------- */
function spawnEnemy(scene){
  if(bossActive) return;

  const x = Phaser.Math.Between(30, WIDTH-30);
  const key = Math.random()<0.5 ? "enemy" : "drone";

  const e = enemies.create(x, -30, key)
    .setOrigin(0.5)
    .setScale(0.25)
    .setDepth(4);

  e.body.setVelocityY(Phaser.Math.Between(120,200));
}

/* ---------------- COLLISIONS ---------------- */
function onEnemyHit(b,e){
  b.destroy();
  e.destroy();
  score += 10;
  scoreText.setText("SCORE: "+score);
}

function onPlayerHit(){
  this.scene.restart();
}

function spawnBoss(scene){
  bossActive = true;
  boss = scene.physics.add.sprite(WIDTH/2, 120, "boss")
    .setOrigin(0.5)
    .setScale(0.35)
    .setDepth(7);

  boss.hp = 30;
}

function onBossHit(b){
  if(!boss) return;
  b.destroy();
  boss.hp--;

  boss.setTint(0xff0000);
  setTimeout(()=>boss.clearTint(),80);

  if(boss.hp<=0){
    boss.destroy();
    boss=null;
    bossActive=false;
    score+=200;
    scoreText.setText("SCORE: "+score);
  }
}
</script>
</body>
</html>
